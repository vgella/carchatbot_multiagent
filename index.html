<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-T8DHWKCNVS"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-T8DHWKCNVS');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LitCode by thirdeye</title>
    <link rel="icon" href="flavicon_thirdeye.png" type="image/png">
    
    <!-- Load Monokai Sublime theme for syntax highlighting -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/monokai-sublime.min.css">
    
    <!-- Load highlight.js library -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>

    <!-- Load marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #ffffff;
            color: #000000;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            overflow-y: scroll;
        }

        /* Tab container with hidden scrollbar */
        #tab-container {
            display: flex;
            justify-content: space-between; /* This will place the logo on the left and tab on the right */
            align-items: flex-end;
            width: 100%;
            background-color: #D3D3D3;
            padding: 0; /* Add padding for spacing */
            margin: 0;
            box-sizing: border-box;
            height: auto; /* Adjust height to fit the content */
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* Hide the scrollbar */
        #tab-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }

        #tab-container {
            -ms-overflow-style: none;  /* Internet Explorer 10+ */
            scrollbar-width: none;  /* Firefox */
        }

        .tabs-wrapper {
            display: flex;
            justify-content: flex-start;
            align-items: flex-end;
            height: 50%; /* Bottom half for the tabs */
            width: 100%;
            padding: 0;
            box-sizing: border-box;
        }
        /* Tabs */
        #litcode-logo {
            height: 50px; /* Adjust height to fit the logo size */
            margin-left: 20px; /* Add some margin to the left */
        }
        /* Tabs on the right side */
        .tab {
            background-color: #000000;
            border-radius: 15px 15px 0 0;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 7.5px 15px;
            width: 150px; /* Adjust width as necessary */
            margin-right: 5px; /* Add some space between the tab and the right edge */
            margin-bottom: 0;
        }
        
        /* Make sure the tab is always aligned to the right */
        #tab-container .tab.active {
            margin-left: auto; /* Pushes the tab to the far right */
        }
        .tab input {
            border: none;
            background-color: transparent;
            outline: none;
            text-align: center;
            font-size: 16px;
            color: white;
            width: 100px;
            display: block; /* Ensure input is block-level */
        }

        .tab.shrunk input {
            display: none; /* Hide the tab title when shrunk */
        }

        .tab.active {
            background-color: #000000;
            color: white;
            z-index: 1;
        }
        /* Hide inactive tabs */
        .tab.hidden {
            display: none;
        }


        /* Chat container */
        #chat-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: calc(100vh - 112px);
            box-sizing: border-box;
            overflow-y: auto;
            flex-grow: 1;
            position: relative;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer and Edge */
        }
        
        #chat-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, and Opera */
        }
        /* Dropdown container */
        #model-select-container {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 2;
            display: inline-block;
        }
    
        /* Dropdown styling */
        #model-select {
            padding: 10px;
            font-size: 16px;
            color: white;
            background-color: black;
            border: 2px solid white;
            border-radius: 5px;
            outline: none;
            appearance: none;
            cursor: pointer;
            padding-right: 30px;
            transition: background-color 0.3s, border-color 0.3s;
        }

        #model-select-container::after {
            content: 'â–¼';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            pointer-events: none;
        }

        #model-select option {
            background-color: black;
            color: white;
        }

        #model-select option:checked {
            background-color: #007bff;
            color: white;
        }

        #model-select:hover {
            background-color: #333;
            border-color: black;
        }

        #model-select:focus {
            border-color: black;
            outline: none;
        }

        #chat-box {
            flex-grow: 1;
            width: calc(100% - 40px);
            display: flex;
            flex-direction: column;
            gap: 15px;
            color: white;
            background-color: #000000;
            padding: 60px 20px 20px 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            word-wrap: break-word;
            position: relative;

        }

        .message {
            padding: 0;
            background-color: transparent;
            box-shadow: none;
            margin-bottom: 0;
        }

        .message.user {
            align-self: flex-end;
            background-color: white;
            padding: 10px;
            border-radius: 15px;
            margin-bottom: 10px;
            color: black;
        }

        .message.ai {
            align-self: stretch;
            width: 100%;
            background-color: transparent;
            color: #ffffff;
            padding: 0;
            margin: 0;
            border: none;
        }

        .message pre code {
            background-color: #1e1e1e;
            color: #f8f8f2;
            width: 100%;
            border-radius: 0;
            padding: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Fira Code', monospace;
        }

        #input-container {
            width: calc(100% - 20px);
            display: flex;
            align-items: center;
            gap: 10px;
            color: black;
            padding: 10px;
            background-color: transparent;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        .main-input-field {
            flex-grow: 1;
            padding: 15px;
            border: none;
            font-size: 16px;
            outline: none;
            background-color: #ffffff;
            color: #000000;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
        }

        .main-input-field:focus {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .main-input-field::placeholder {
            color: #000000;
        }

        .send-button-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            background: none;
            border: none;
        }

        .triangle {
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 40px solid black;
            cursor: pointer;
            outline: none;
            transition: transform 0.3s ease;
        }

        .triangle:hover {
            transform: scale(1.1);
        }
        @keyframes fadeInOut {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
        #white-eye-logo {
            width: 343px;
            height: auto;
            display: block;
            margin: 20px auto;
            pointer-events: none;
        }
        .eye-fade {
            animation: fadeInOut 2s infinite; /* 2 seconds for the full cycle, infinitely repeated */
        }
        .footer-links {
            text-align: center;
            position: relative;
            margin-top: 5px;
        }

        .footer-links a {
            display: inline-block;
            margin: 0 15px;
            text-decoration: none;
            color: black;
            font-family: 'Times New Roman', serif;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
        }
        
        .footer-links a:hover {
            text-decoration: underline;
        }

        .popup-content {
            padding: 20px;
            max-width: 600px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: Arial, sans-serif;
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        #feedback-button {
            position: relative;
            margin: 15px 0;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #feedback-button:hover {
            background-color: #0056b3;
        }

        /* Hamburger menu styles */
        .hamburger-menu {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            z-index: 3;
            display: flex;
            flex-direction: column;
            gap: 5px;
            padding: 10px;
            background-color: transparent;
        }

        .hamburger-menu .line {
            width: 30px;
            height: 3px;
            background-color: white; /* White hamburger button */
        }

        /* Sidebar styles */
        .sidebar {
            position: absolute;
            top: 0;
            right: -343px; /* Move the sidebar completely out of view */
            width: 300px;
            height: calc(100vh - 170px);
            background-color: transparent;
            border-radius: 15px 0 0 15px;
            transition: right 0.3s ease;
            z-index: 5; /* High z-index to give priority when opened */
            display: flex;
            flex-direction: column;
            padding: 20px; /* Added padding to not touch the top */
        }

        .sidebar.open {
            right: 0; /* When open, it slides in */
        }

        /* Sidebar Content Styling */
        .sidebar-header {
            margin-bottom: 20px;
        }

        .search-tabs {
            width: calc(100% - 20px);
            padding: 10px;
            font-size: 16px;
            border: none;
            margin-bottom: 10px; /* Same spacing as the sidebar tab */

            border-radius: 5px;
        }

        .sidebar-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }

        .sidebar-content .sidebar-tab {
            background-color: #000000;
            color: white;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .sidebar-content .sidebar-tab:hover {
            background-color: #f0f0f0;
        }
        .add-page-sidebar-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: white;
            color: black;
            font-size: 30px;
            font-weight: bold;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .add-page-sidebar-button:hover {
            background-color: #f0f0f0;
        }

    </style>
</head>
<body>

    <div id="tab-container">
        <img id="litcode-logo" src="litcode_logo_slick.svg" alt="Litcode Logo">
        <div class="tab active" id="new-page-1" data-page-name="New Page 1">
            <input type="text" value="New Page 1" class="tab-title" />
        </div>

    </div>

    <div id="chat-container">
        <!-- Hamburger menu inside the chat container -->
        <div id="hamburger-menu" class="hamburger-menu">
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
        </div>

        <!-- Sidebar inside the chat container -->
        <div id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <input type="text" id="search-tabs" class="search-tabs" placeholder="Search tabs or chats..." />
            </div>
            <div id="sidebar-content" class="sidebar-content">
                <!-- This will be populated with the tab titles dynamically -->
            </div>
            <!-- Add this inside the sidebar div, at the end -->
            <button id="add-page-sidebar-button" class="add-page-sidebar-button">+</button>
        </div>

        <div id="model-select-container">
            <select id="model-select">
                <option value="litchat superbasic">llama3.2 (fastest general chat)</option>
                <option value="litchat basic"> llama3.1 (general chat)</option>
                <option value="basic"> mixtral (basic coding)</option>
                <option value="qwen2-math"> Qwen2 Math (fast math)</option>
                <option value="advanced"> deepseek-coderv2 (premium coding)</option>
                <option value="litchat premium">LitChat Premium (general chat)</option>
                <option value="nemotron-mini"> NVIDIA's nemotron-mini (fast)</option>
                <option value="gemma"> Google's gemma (fast)</option>
                <option value="phi3.5"> phi3.5 (fast coding)</option>
                <option value="hermes3"> Hermes3 (general chat)</option>
                <option value="solar-pro"> Advanced Solar-Pro (slowest)</option>
                <option value="bespoke-mini"> bespoke-mini factchecker (fast)</option>
                <option value="command-r"> command-r (executive, slowest)</option>


            </select>
        </div> 

        <div id="chat-box">
            <img id="white-eye-logo" src="white_eye_logo.svg" alt="White Eye Logo" />
        </div>

        <div id="input-container">
            <input type="text" id="coding-task-input" class="main-input-field" placeholder="Type your message here..." />
            <div class="send-button-container" id="send-button">
                <div class="triangle"></div>
            </div>
        </div>
    </div>

    <div class="footer-links">
        <a href="javascript:void(0);" onclick="openPopup('notice.txt', 'Notice')">Notice</a>
        <a href="javascript:void(0);" onclick="openPopup('terms_and_agreement.txt', 'Terms and Conditions')">Terms and Conditions</a>
        <a href="https://thirdeyeai.org" target="_blank">thirdeye ai</a> <!-- New link to LitCode -->
    </div>

    <script>
        const chatBox = document.getElementById('chat-box');
        const whiteEyeLogo = document.getElementById('white-eye-logo');
        const codingTaskInput = document.getElementById('coding-task-input');
        const sendButton = document.getElementById('send-button');
        const sidebarAddPageButton = document.getElementById('add-page-sidebar-button');
        const hamburgerMenu = document.getElementById('hamburger-menu');
        const sidebar = document.getElementById('sidebar');
        const sidebarContent = document.getElementById('sidebar-content');
        const searchTabs = document.getElementById('search-tabs');
        let feedbackButtonShown = {};
        let userIp = '';
        let currentPage = 'New Page 1';
        let pageCount = 1;
        let syntaxHighlightTimeout;
        let sidebarVisible = false;

        let chatHistories = {
            'New Page 1': []
        };
        
        // Function to save the state to localStorage
        function saveStateToLocalStorage() {
            const sidebarTabs = Array.from(sidebarContent.querySelectorAll('.sidebar-tab')).map(tab => tab.textContent);
            const storedData = {
                chatHistories,
                pageCount,
                sidebarTabs,
                currentPage
            };
            localStorage.setItem('chatAppState', JSON.stringify(storedData));
        }

        // Function to load the state from localStorage
        function loadStateFromLocalStorage() {
            const savedState = localStorage.getItem('chatAppState');
            if (savedState) {
                const { chatHistories: storedHistories, pageCount: storedPageCount, sidebarTabs: storedSidebarTabs, currentPage: storedPage } = JSON.parse(savedState);
                
                chatHistories = storedHistories || {};
                pageCount = storedPageCount || 1;
                currentPage = storedPage || 'New Page 1';
        
                // Recreate sidebar tabs from localStorage
                storedSidebarTabs.forEach(pageName => createSidebarTab(pageName));
                
                // Load the chat history for the first page
                loadChatHistory(currentPage);
                updateActiveTab(currentPage);
            } else {
                // First-time load (or no saved state): initialize with one page
                createSidebarTab('New Page 1');
                chatHistories['New Page 1'] = [];
                saveStateToLocalStorage();
            }
        }

        // Function to create a new tab in the main tab container
        function createTabInContainer(pageName) {
            const newTab = document.createElement('div');
            newTab.classList.add('tab');
            newTab.setAttribute('data-page-name', pageName);
            newTab.innerHTML = `<input type="text" value="${pageName}" class="tab-title" />`;

            const currentActiveTab = document.querySelector('.tab.active');
            if (currentActiveTab) {
                currentActiveTab.classList.remove('active');
            }

            newTab.classList.add('active');
            document.getElementById('tab-container').appendChild(newTab);

            // Add event listener to handle renaming of the tab and sidebar sync
            const tabTitleInput = newTab.querySelector('.tab-title');
            const sidebarTab = sidebarContent.querySelector(`.sidebar-tab:contains("${pageName}")`);
            addTabEditEventListener(tabTitleInput, sidebarTab, pageName);
        }

        // Function to create the default tab ("New Page 1")
        function createDefaultTab() {
            const defaultPage = 'New Page 1';
            
            chatHistories[defaultPage] = [];

            // Create the sidebar tab and the tab container
            createSidebarTab(defaultPage);
            createTabInContainer(defaultPage);

            // Set the current page and load its history
            currentPage = defaultPage;
            loadChatHistory(defaultPage);
        }

        // Update add-page-sidebar-button event to create new pages appropriately numbered
        sidebarAddPageButton.addEventListener('click', () => {
            pageCount++;
            const newPageName = `New Page ${pageCount}`;

            // Create the new tab in the main container and the sidebar
            createSidebarTab(newPageName);
            createTabInContainer(newPageName);

            // Add the new page to chatHistories
            chatHistories[newPageName] = [];
            saveStateToLocalStorage();
        });

        // Create a sidebar tab for each page
        function createSidebarTab(pageName) {
            const sidebarTab = document.createElement('div');
            sidebarTab.classList.add('sidebar-tab');
            sidebarTab.textContent = pageName;
            
            // Add event listener to switch to the clicked tab
            sidebarTab.addEventListener('click', () => {
                const tabElement = document.querySelector(`.tab[data-page-name="${pageName}"]`);
                if (tabElement) {
                    setActiveTab(tabElement, pageName);
                }
                sidebar.classList.remove('open');
                sidebarVisible = false;
            });

            sidebarContent.appendChild(sidebarTab);
            saveStateToLocalStorage();  // Save the updated state
        }

        // Set active tab and load the corresponding chat history
        function setActiveTab(tab, pageName) {
            // Hide all other tabs
            const allTabs = document.querySelectorAll('.tab');
            allTabs.forEach((otherTab) => {
                otherTab.classList.add('hidden'); // Hide inactive tabs
            });

            // Remove the 'hidden' class from the active tab to show it
            tab.classList.remove('hidden');

            // Remove the current active tab
            const activeTab = document.querySelector('.tab.active');
            if (activeTab) {
                activeTab.classList.remove('active');
            }

            // Set the new tab as active
            tab.classList.add('active');
            currentPage = pageName;

            // Load the chat history for the newly active page
            loadChatHistory(pageName);

            // Save the active tab to localStorage
            saveStateToLocalStorage();
        }

        // Function to load chat history
        function loadChatHistory(pageName) {
            chatBox.innerHTML = '';
            const history = chatHistories[pageName] || [];

            if (history.length === 0) {
                chatBox.appendChild(whiteEyeLogo);
            } else {
                history.forEach(msg => {
                    appendMessage(msg.sender, msg.text, msg.isCode);
                });
                chatBox.appendChild(whiteEyeLogo);
            }
            reapplySyntaxHighlighting();
        }

        // Function to update the active tab's appearance and title in localStorage
        function addTabEditEventListener(tabTitle, sidebarTab, originalPageName) {
            tabTitle.addEventListener('input', function () {
                sidebarTab.textContent = tabTitle.value; // Sync sidebar tab with edited title
                saveStateToLocalStorage();  // Save the new title to localStorage
            });

            tabTitle.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    this.blur();  // Remove focus on pressing Enter
                    saveStateToLocalStorage();  // Save changes
                }
            });
        }

        // Populate the sidebar and chat history on load
        window.addEventListener('load', () => {
            loadStateFromLocalStorage();
        });

        function reapplySyntaxHighlighting() {
            if (syntaxHighlightTimeout) {
                clearTimeout(syntaxHighlightTimeout);
            }
            syntaxHighlightTimeout = setTimeout(() => {
                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            }, 100);
        }

        const firstTab = document.getElementById('new-page-1');
        const firstSidebarTab = document.createElement('div');
        firstSidebarTab.classList.add('sidebar-tab');
        firstSidebarTab.textContent = 'New Page 1';

        firstSidebarTab.addEventListener('click', () => {
            setActiveTab(firstTab, 'New Page 1');
            sidebar.classList.remove('open');
            sidebarVisible = false;
        });

        sidebarContent.appendChild(firstSidebarTab);

        const firstTabTitle = firstTab.querySelector('.tab-title');
        firstTabTitle.addEventListener('input', function () {
            firstSidebarTab.textContent = firstTabTitle.value;
        });

        firstTabTitle.addEventListener('click', function () {
            this.focus();
        });

        firstTabTitle.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                this.blur();
            }
        });

    </script>
</body>
</html>
