<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ditra demo (thirdeye)</title>
    <link rel="icon" href="flavicon_thirdeye.png" type="image/png">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/monokai-sublime.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #ffffff;
            color: #000000;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: scroll;
        }

        /* Tabs and Sidebar */
        #tab-container { display: flex; justify-content: flex-start; align-items: flex-end; width: 100%; background-color: #f0f0f0; }
        .tab { background-color: #e0e0e0; border-radius: 15px 15px 0 0; padding: 7.5px 15px; width: 150px; text-align: center; cursor: pointer; }
        .tab.active { background-color: #ffffff; }
        .hidden { display: none; }

        /* Chatbox */
        #chat-container { width: 100%; display: flex; flex-direction: column; align-items: center; height: calc(100vh - 112px); }
        #chat-box { flex-grow: 1; width: 100%; padding: 20px; overflow-y: auto; }
        .message { padding: 10px; border-radius: 10px; margin-bottom: 5px; }
        .user { background-color: #f0f0f0; text-align: right; }
        .ai { background-color: #dfe7fd; }

        /* Inputs */
        #input-container { width: 100%; display: flex; padding: 10px; background-color: #fff; }
        .main-input-field { flex-grow: 1; padding: 15px; border: none; border-radius: 10px; }
        .send-button { padding: 10px 20px; background-color: black; color: white; border: none; cursor: pointer; }

        /* Prompt and Data Tabs */
        .static-content { padding: 20px; }
        .prompt-text, .synthetic-data { width: 100%; min-height: 200px; padding: 10px; border: 1px solid #ddd; }
    </style>
</head>
<body>

    <!-- Tabs for Chat, Prompt, and Client Data -->
    <div id="tab-container">
        <div class="tab active" id="chat-tab">Chat</div>
        <div class="tab" id="prompt-tab">Agent Prompts</div>
        <div class="tab" id="synthetic-tab">Client Data</div>
    </div>

    <!-- Chatbox -->
    <div id="chat-container">
        <div id="chat-box"></div>
        <div id="input-container">
            <input type="text" id="chat-input" class="main-input-field" placeholder="Type your message..." />
            <button id="send-button" class="send-button">Send</button>
        </div>
    </div>

    <!-- Prompt Management -->
    <div id="prompt-content" class="static-content hidden">
        <h2>Agent Prompts</h2>
        <textarea id="prompt-editable" class="prompt-text" spellcheck="false"></textarea>
        <button id="save-prompts">Save Prompts</button>
    </div>

    <!-- Synthetic Client Data -->
    <div id="synthetic-content" class="static-content hidden">
        <h2>Client Data</h2>
        <textarea id="synthetic-editable" class="synthetic-data" spellcheck="false"></textarea>
        <button id="save-synthetic">Save Data</button>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            setupTabs();
            fetchInitialValues();
        });

        function setupTabs() {
            document.getElementById("chat-tab").addEventListener("click", () => switchTab("chat"));
            document.getElementById("prompt-tab").addEventListener("click", () => switchTab("prompt"));
            document.getElementById("synthetic-tab").addEventListener("click", () => switchTab("synthetic"));
        }

        function switchTab(tab) {
            document.getElementById("chat-container").classList.toggle("hidden", tab !== "chat");
            document.getElementById("prompt-content").classList.toggle("hidden", tab !== "prompt");
            document.getElementById("synthetic-content").classList.toggle("hidden", tab !== "synthetic");
        }

        function fetchInitialValues() {
            fetch('https://your-ngrok-url/init_vals', { method: 'POST', headers: { 'Content-Type': 'application/json' } })
                .then(response => response.json())
                .then(data => {
                    document.getElementById("prompt-editable").value = data.premise;
                    document.getElementById("synthetic-editable").value = data.data;
                });
        }

        function updateValues(endpoint, payload) {
            fetch(`https://your-ngrok-url/${endpoint}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            }).then(response => response.json()).then(console.log);
        }

        document.getElementById("save-prompts").addEventListener("click", () => {
            updateValues("update_vals", { premise: document.getElementById("prompt-editable").value });
        });

        document.getElementById("save-synthetic").addEventListener("click", () => {
            updateValues("update_vals", { data: document.getElementById("synthetic-editable").value });
        });

        document.getElementById("send-button").addEventListener("click", () => sendChatMessage());

        function sendChatMessage() {
            const userMessage = document.getElementById("chat-input").value;
            if (!userMessage) return;
            appendMessage("User", userMessage, "black");
            document.getElementById("chat-input").value = "";

            fetchSequentially([
                { endpoint: "chat", color: "blue" },
                { endpoint: "user_profile", color: "green" },
                { endpoint: "hard_constraints", color: "red" },
                { endpoint: "soft_constraints", color: "purple" },
                { endpoint: "ai_response", color: "black" }
            ], userMessage);
        }

        function fetchSequentially(steps, message) {
            if (!steps.length) return;

            const { endpoint, color } = steps.shift();
            fetch(`https://your-ngrok-url/${endpoint}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message })
            })
            .then(response => response.json())
            .then(data => {
                appendMessage(endpoint.replace("_", " "), data.response, color);
                fetchSequentially(steps, message);
            });
        }

        function appendMessage(sender, text, color) {
            const chatBox = document.getElementById("chat-box");
            const messageElement = document.createElement("div");
            messageElement.classList.add("message");
            messageElement.style.color = color;
            messageElement.innerHTML = `<strong>${sender}:</strong> ${text}`;
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>

</body>
</html>
